<div class="dashboard d-flex flex-wrap justify-content-between">
  <div class="main-data aside text-doctor">
    <div class="header">
      <div class="mx-2">
        Nova Receita
      </div>

      <div class="control">
        <fa-icon [icon]="faEdit" (click)="isEditing = !isEditing"></fa-icon>
        <fa-icon [icon]="faSave" (click)="save()"></fa-icon>
        <fa-icon [icon]="faShare"></fa-icon>
        <fa-icon [icon]="faSearch" (click)="toogle()"></fa-icon>
      </div>
    </div>

    <div class="search" *ngIf="showSearch">
      <div class="form">
        <div class="input">
          <input type="text" name="search" placeholder="Nome do paciente" />
          <fa-icon [icon]="faSearch" (click)="search()"></fa-icon>
        </div>

        <div class="results">
          <div class="label">
            Resultados

            <strong class="ml-1"> 4</strong>
          </div>

          <div class="wrapper">
            <div class="result">
              <div>João das Colves</div>
              <fa-icon
                [icon]="faFileMedical"
                class="text-success cursor ml-2"
              ></fa-icon>
            </div>

            <div class="result">
              <div>Maria Sem graça</div>

              <fa-icon
                [icon]="faFileMedical"
                class="text-success cursor ml-2"
              ></fa-icon>
            </div>

            <div class="result">
              <div>Pedro Antunes</div>

              <fa-icon
                [icon]="faFileMedical"
                class="text-success cursor ml-2"
              ></fa-icon>
            </div>
            <div class="result">
              <div>Marcolino Frango</div>

              <fa-icon
                [icon]="faFileMedical"
                class="text-success cursor ml-2"
              ></fa-icon>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="prescription-body">
      <div class="prescription-header">
        <div class="field">
          <div class="icon">
            <fa-icon [icon]="faUserMd" class="mr-1"></fa-icon>
          </div>
          Doutor: <strong>Pedro Alvares Cabral II</strong>
        </div>
        <div class="field">
          <div class="icon">
            <fa-icon [icon]="faHeartbeat" class="mr-1"></fa-icon>
          </div>

          Paciente: <strong> Rosinha Garotinho</strong>
        </div>

        <div class="field">
          <div class="icon">
            <fa-icon [icon]="faFileMedical" class="mr-1"></fa-icon>
          </div>
          Receita <strong>#456</strong>
        </div>
        <div class="field">
          <div class="icon"><fa-icon [icon]="faCalendarPlus"></fa-icon></div>
          Data: <strong> {{ prettyDate }}</strong>
        </div>
      </div>

      <div class="actions">
        <div class="add medicine" (click)="showAddM()">
          Adicionar Medicamento
          <fa-icon [icon]="faCapsules"></fa-icon>
        </div>
        <div class="add exam" (click)="showAddE()">
          Adicionar Exame
          <fa-icon [icon]="faVial"></fa-icon>
        </div>
        <div class="add recocomendação" (click)="showAddR()">
          Adicionar Recomendação
          <fa-icon [icon]="faExclamationCircle"></fa-icon>
        </div>
      </div>

      <div *ngIf="addM" class="new-med">
        <div class="wrapper">
          <strong>Medicamento</strong>
          <div class="select">
            <label for="category">Categoria</label>
            <select
              id="type"
              name="category"
              class="in cursor"
              style="border: 1px solid var(--doctor); color: var(--doctor);"
            >
              <option value="cat.value" *ngFor="let cat of category">{{
                cat.label
              }}</option>
            </select>
          </div>

          <div class="select">
            <label for="subcategory">Sub-categoria</label>
            <select
              id="include"
              name="subcategory"
              class="in cursor"
              style="border: 1px solid var(--doctor); color: var(--doctor);"
            >
              <option value="sub.value" *ngFor="let sub of subcategory">{{
                sub.label
              }}</option>
            </select>
          </div>
          <div class="buttons">
            <div class="bts">
              <button class="bt-doctor" (click)="showSearchMed()">
                Buscar
                <fa-icon [icon]="faSearch"></fa-icon>
              </button>
              <button class="bt-oposity1" (click)="showAddNF()">
                Fórmula
                <fa-icon [icon]="faFlask"></fa-icon>
              </button>
            </div>
          </div>
        </div>

        <div class="wrapper-search" *ngIf="searchMed">
          <div class="search-med">
            <div class="form-med">
              <div class="input">
                <input
                  type="text"
                  name="search"
                  placeholder="Nome do remédio"
                  #search
                />
                <fa-icon
                  [icon]="faSearch"
                  (click)="search.value && searchMedicine(search.value)"
                  class="cursor"
                ></fa-icon>

                <fa-icon
                  [icon]="faTimes"
                  (click)="showAddM()"
                  class="cursor ml-1"
                ></fa-icon>
              </div>

              <div class="results">
                <div class="label">
                  Resultados
                  <strong class="ml-1">{{ searchMedicines.length }}</strong>
                </div>

                <div class="wrapper-medicines">
                  <div
                    class="medicine"
                    *ngFor="let medicine of searchMedicines"
                  >
                    <div class="info">
                      <div class="name d-flex">
                        {{ fmrt(medicine._source.product) }}
                      </div>
                      <div class="lab d-flex">
                        <fa-icon [icon]="faFlask" class="mr-1"></fa-icon>
                        {{ fmrt(medicine._source.laboratory) }}
                      </div>
                      <div class="lab d-flex">
                        <fa-icon [icon]="faBox" class="mr-1"></fa-icon>
                        {{ fmrt(medicine._source.presentantion) }}
                      </div>
                      <div class="lab d-flex">
                        <fa-icon [icon]="faBox" class="mr-1"></fa-icon>
                        {{ fmrt(medicine._source.product_type) }}
                      </div>
                      <div class="lab d-flex">
                        <fa-icon [icon]="faBox" class="mr-1"></fa-icon>
                        {{ fmrt(medicine._source.stripe) }}
                      </div>
                      <div class="lab d-flex">
                        <fa-icon [icon]="faBox" class="mr-1"></fa-icon>
                        {{ fmrt(medicine._source.substance) }}
                      </div>
                    </div>
                    <div class="button">
                      <button (click)="addMedicine(medicine._source)">
                        <fa-icon
                          [icon]="faPlusCircle"
                          class="text-oposity"
                        ></fa-icon>
                        Selecionar
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div *ngIf="addNF" class="new-formule">
        <div class="tools">
          Fórmula
          <fa-icon [icon]="faSave" class="mr-1 cursor"></fa-icon>
          <fa-icon
            [icon]="faTimes"
            class="mr-1 cursor"
            (click)="showAddNF()"
          ></fa-icon>
        </div>
        <textarea
          name="formula"
          #reconm
          cols="30"
          rows="10"
          placeholder="Descreva a formula do medicamento"
        >
        </textarea>
      </div>

      <div *ngIf="addE" (mouseleave)="showAddE()">
        <form [formGroup]="prescriptionForm" class="exams">
          <div>Exames disponíveis</div>
          <div class="">
            <app-mult-selector-drop-drown
              name="exams"
              formControlName="exams"
              [states]="availableExams"
              [mainColor]="mainColor"
              [width]="'210px'"
              [height]="'30px'"
            ></app-mult-selector-drop-drown>
            <div
              class="d-flex mx-2 flex-column justify-content-center align-items-center"
            >
              <fa-icon [icon]="faFlask" class="text-oposity"></fa-icon>
            </div>
          </div>
        </form>
      </div>

      <div *ngIf="addR" class="new-recom" (mouseleave)="showAddR()">
        <div class="tools">
          Recomendação
          <fa-icon
            [icon]="faSave"
            class="mr-1 cursor"
            (click)="saveR(reconm.value)"
          ></fa-icon>
          <fa-icon
            [icon]="faTimes"
            class="mr-1 cursor"
            (click)="showAddR()"
          ></fa-icon>
        </div>
        <textarea
          name="recomendation"
          #reconm
          cols="30"
          rows="10"
          placeholder="Escreva aqui recomendações ao paciente"
          value="R{{ recomendations.length + 1 }}: "
          (keyup.enter)="saveR(reconm.value)"
        >
        </textarea>
      </div>

      <div
        class="resume"
        *ngIf="
          recomendations.length > 0 ||
          medicines.length > 0 ||
          prescriptionForm.value.exams.length > 0
        "
      >
        <strong> Resumo</strong>

        <div *ngIf="recomendations.length > 0" class="my-1">
          <div>
            <fa-icon [icon]="faExclamationCircle"></fa-icon>
            <strong> Recomendações</strong>
          </div>
          <div *ngFor="let r of recomendations">
            <div>{{ r }}</div>
          </div>
        </div>
        <div *ngIf="medicines.length > 0" class="my-1">
          <div>
            <fa-icon [icon]="faCapsules"></fa-icon>

            <strong> Medicamentos</strong>
          </div>
          <div *ngFor="let medicine of medicines">
            {{ fmrt(medicine.substance) }} &nbsp;
            {{ fmrt(medicine.presentantion) }}
          </div>
        </div>

        <div *ngIf="prescriptionForm.value.exams.length > 0" class="my-1">
          <div>
            <fa-icon [icon]="faVial"></fa-icon>

            <strong> Exames</strong>
          </div>
          <div *ngFor="let exam of prescriptionForm.value.exams">
            {{ exam }}
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
